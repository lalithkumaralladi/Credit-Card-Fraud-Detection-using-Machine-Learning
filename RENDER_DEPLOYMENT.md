# Deploying to Render - Complete Guide

## Quick Start

### Option 1: Using render.yaml (Recommended)

1. **Push your code to GitHub**
   - Create a GitHub repository
   - Push all your code to the repository

2. **Connect to Render**
   - Go to [Render Dashboard](https://dashboard.render.com/)
   - Click "New" â†’ "Blueprint"
   - Connect your GitHub repository
   - Render will automatically detect the `render.yaml` file and configure everything

3. **Deploy**
   - Click "Apply" and Render will deploy your app automatically!

### Option 2: Manual Configuration

If you prefer to configure manually or the YAML method doesn't work:

1. **Create a New Web Service**
   - Go to [Render Dashboard](https://dashboard.render.com/)
   - Click "New" â†’ "Web Service"
   - Connect your GitHub repository

2. **Configure Build Settings**
   
   **Build Command:**
   ```bash
   pip install -r requirements.txt
   ```
   
   **Start Command:**
   ```bash
   python run.py
   ```

3. **Set Environment Variables** (see below for full list)

---

## Environment Variables for Render

### Required Environment Variables

When deploying manually, add these environment variables in Render's dashboard:

| Variable Name | Value | Description |
|--------------|-------|-------------|
| `PYTHON_VERSION` | `3.11.0` | Python version to use |
| `APP_ENV` | `production` | Set to production mode |
| `DEBUG` | `False` | Disable debug mode in production |
| `HOST` | `0.0.0.0` | Listen on all network interfaces |
| `PORT` | `8000` | Port number (Render provides this automatically) |
| `WORKERS` | `2` | Number of worker processes (2-4 for free tier) |
| `LOG_LEVEL` | `info` | Logging level |

### Optional but Recommended

| Variable Name | Value | Description |
|--------------|-------|-------------|
| `MAX_FILE_SIZE_MB` | `500` | Maximum upload file size in MB |
| `ALLOWED_HOSTS` | `*` | Allowed hosts (use your domain in production) |
| `CORS_ORIGINS` | `*` | CORS origins (use your frontend URL in production) |
| `SECRET_KEY` | `<auto-generated>` | Let Render auto-generate this |
| `ENABLE_COMPRESSION` | `True` | Enable GZip compression |
| `CACHE_STATIC_FILES` | `True` | Enable caching for static files |
| `TIMEOUT_KEEP_ALIVE` | `30` | Keep-alive timeout |
| `LIMIT_CONCURRENCY` | `1000` | Max concurrent connections |
| `LIMIT_MAX_REQUESTS` | `10000` | Max requests before worker restart |

### Performance Tuning (Optional)

| Variable Name | Value | Description |
|--------------|-------|-------------|
| `ENABLE_SMOTE` | `True` | Enable SMOTE for balancing |
| `MAX_SMOTE_SAMPLES` | `100000` | Max samples for SMOTE |
| `SAMPLE_LARGE_DATASETS` | `True` | Auto-sample large datasets |
| `LARGE_DATASET_THRESHOLD` | `50000` | Threshold for large datasets |

---

## Step-by-Step: Adding Environment Variables in Render

1. **Go to your Web Service** in Render dashboard
2. Click on **"Environment"** in the left sidebar
3. Click **"Add Environment Variable"**
4. For each variable:
   - Enter the **Key** (e.g., `APP_ENV`)
   - Enter the **Value** (e.g., `production`)
   - Click **"Save Changes"**

### Pro Tip: Secret Key Generation

For `SECRET_KEY`, instead of entering a value:
1. Click "Add Environment Variable"
2. Enter `SECRET_KEY` as the key
3. Click "Generate" to auto-generate a secure random string

---

## Minimum Configuration (Quick Setup)

If you just want to get started quickly, set only these:

```
APP_ENV=production
DEBUG=False
WORKERS=2
LOG_LEVEL=info
```

All other variables have sensible defaults.

---

## Important Notes

### Free Tier Limitations
- **Workers**: Set to `1` or `2` on free tier (limited CPU)
- **Memory**: Free tier has 512MB RAM
- **Disk**: Ephemeral storage - uploaded files are lost on restart
  
### Persistent Storage (Upgrade Required)
If you need to persist uploaded files and models:
1. Upgrade to a paid plan
2. Add a persistent disk in Render
3. Update environment variables:
   ```
   UPLOAD_DIR=/opt/render/disk/uploads
   MODEL_DIR=/opt/render/disk/models
   ```

### Performance Tips
1. **For Free Tier**: Set `WORKERS=1` to avoid memory issues
2. **For Starter Plan**: Set `WORKERS=2-4` depending on traffic
3. **Large Files**: Consider reducing `MAX_FILE_SIZE_MB` if you have memory issues
4. **Large Datasets**: Keep `SAMPLE_LARGE_DATASETS=True` to prevent timeouts

---

## Troubleshooting

### App Won't Start
- Check that `PYTHON_VERSION` is set to `3.11.0` or higher
- Verify all required packages are in `requirements.txt`
- Check build logs for errors

### Out of Memory
- Reduce `WORKERS` to `1`
- Reduce `MAX_FILE_SIZE_MB`
- Enable `SAMPLE_LARGE_DATASETS=True`
- Lower `MAX_SMOTE_SAMPLES`

### Slow Response Times
- Increase `WORKERS` (if you have enough memory)
- Enable `ENABLE_COMPRESSION=True`
- Reduce `LARGE_DATASET_THRESHOLD`

### Files Not Persisting
- Files uploaded to the free tier are lost on restart
- Upgrade to a paid plan and add persistent disk storage
- Or use external storage (AWS S3, etc.)

---

## Post-Deployment

After deployment, your app will be available at:
```
https://your-app-name.onrender.com
```

### Test Your Deployment
1. Visit the URL
2. Upload a small CSV file to test
3. Check the logs in Render dashboard for any errors

### Monitoring
- **Logs**: View in Render Dashboard â†’ Your Service â†’ Logs
- **Metrics**: View in Render Dashboard â†’ Your Service â†’ Metrics
- **Health**: Render automatically monitors your service health

---

## Security Best Practices (Production)

Once your app is working, update these for production:

```bash
# Set to your actual domain
ALLOWED_HOSTS=your-app.onrender.com

# Set to your frontend URL
CORS_ORIGINS=https://your-frontend.com

# Auto-generate a strong secret key
SECRET_KEY=<use Render's auto-generate feature>
```

---

## Need Help?

- **Render Docs**: https://render.com/docs
- **FastAPI Docs**: https://fastapi.tiangolo.com/
- **Check Logs**: Always check the deployment logs in Render dashboard

---

## Quick Reference: Render Dashboard Locations

| Setting | Location |
|---------|----------|
| Environment Variables | Service â†’ Environment |
| Build & Deploy | Service â†’ Settings |
| Logs | Service â†’ Logs |
| Metrics | Service â†’ Metrics |
| Disk Storage | Service â†’ Disk |

Good luck with your deployment! ðŸš€
